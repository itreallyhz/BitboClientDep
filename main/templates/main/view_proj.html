<div id="whole-content" style="display: none;">
{% extends 'main/index.html' %}
{% load static %}
{% block content %}

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
       <div class="square">
                <div class="container-fluid">
                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0">Create Project</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                    <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label class="form-label" for="project-title-input">Project Title <span>*</span></label>
                                             <input type="text" class="form-control" id="title" placeholder="Enter project title">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="asterisk">
                                            <label for="" class="form-label" placeholder="Enter Project Type">Project Type<span> *</span></label>
                                            <select class="form-select"  id="projType">
                                                <option value=""></option>
                                                <option value="Medical Mission">Medical Mission</option>
                                                <option value="Feeding Program">Feeding Program</option>
                                                <option value="Community Service">Community Service</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- <div class="col-lg-4">
                                        <div class="asterisk">
                                        <label class="form-label" for="project-thumbnail-img">Thumbnail Image <span>*</span></label>
                                        <input class="form-control" id="project-thumbnail-img" type="file" accept="image/png, image/gif, image/jpeg">
                                    </div>
                                </div> -->
                            </div>

                                    <div class="mb-3">
                                        <div class="asterisk">
                                    <label class="form-label" for="des-info-description-input"><br>Project Description<span> *</span></label>
                                   <textarea class="form-control" placeholder="Enter Description" id="description" rows="6"></textarea>
                                  </div>
                                </div>

                                    <div class="row">
                                 
                                        <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label for="" class="form-label">Status<span> *</span></label>
                                                <select class="form-select"  id="status">
                                                    <option value=""></option>
                                                    <option value="In progress">In progress</option>
                                                    <option value="Completed">Completed</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label for="datepicker-deadline-input" class="form-label">Duration<span> *</span></label>
                                                <input type="text" class="form-control" id="duration" placeholder="Enter duration" data-provider="flatpickr">
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label for="datepicker-deadline-input" class="form-label">Date Started<span> *</span></label>
                                                <input type="date" class="form-control" id="started" placeholder="Enter date started" data-provider="flatpickr">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label class="form-label"><br>Budget<span> *</span></label>
                                                <input type="text" class="form-control" id="budget" placeholder="Enter Budget">
                                        </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="asterisk">
                                                <label class="form-label"><br>Source of Funds<span> *</span></label>
                                                <input type="text" class="form-control" id="source" placeholder="Enter Source of Funds">
                                    </div>
                                    </div>
                                </div>
                                <!-- end card body -->
                            </div>
                            <!-- end card -->

                            <div class="clickbutton">
                            <div class="text-end mb-4">
                                <div class="card-body">
                                    <div class="live-preview">
                                        <div class="button-container">
                                            <!-- cancel button with modals -->
                                            <div class="cancel-button">
                                            <button class="btn btn-primary waves-effect waves-light" data-bs-toggle="modal" data-bs-target=".bs-example-modal-center">Cancel</button>
                                        </div>
                                            <div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-body text-center p-5">
                                                            <div class="mt-4">
                                                                <h4 class="mb-3">Are you sure you want to cancel?</h4>
                                                                <div class="hstack gap-2 justify-content-center">
                                                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">No</button>
                                                                    <a href="{% url 'projects' %}" class="btn btn-danger">Yes</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div><!-- /.modal-content -->
                                                </div><!-- /.modal-dialog -->
                                            </div><!-- /.modal -->
                                        <div class="save-button">
                                            <button type="button" class="btn btn-success waves-effect waves-light"  id="confirmSubmitBtn">Save</button>
                                        </div><!-- end save button -->
                                            </div><!-- end button container -->
                                        </div><!-- end live preview -->
                                    </div><!-- end card body (Start button) -->
                                </div> <!--end col lg emergency info-->
                            </div>
                            </div>
                        </div>
                                <!-- end card body -->
                            </div>
                            <!-- end card -->
                        </div>
                        <!-- end col -->
                </div>
                <!-- container-fluid -->
            </div><!--div protection-->
{% block css %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/view_proj_prog.css' %}">
<link href="{% static 'img/bitbo_logo.png' %}" rel="icon">
{% endblock %}


{% block js%}
 <!-- dropzone js -->
 <script src="{% static 'libs/dropzone/dropzone-min.js' %}"></script>
 <!-- project-create init -->
 <script src="{% static 'js/pages/project-create.init.js' %}"></script>

 <!-- App js -->
 <script src="{% static 'js/app.js' %}"></script>
 <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
 <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

   <script>
  $(document).ready(function () {
    // Handle the actual form submission in the second modal
    $("#confirmSubmitBtn").unbind('click').click(function (event) {
        event.preventDefault();

        // Add class to all required fields for highlighting
        var isValid = true;
        $('.asterisk input, .asterisk select, .asterisk textarea').each(function () {
            var fieldValue = $(this).val();
            if (fieldValue.trim() === '') {
                $(this).addClass('is-invalid');
                isValid = false;
                Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Personal information fields are required! ",
        });
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        if (isValid) {
            // If all fields are valid, show SweetAlert confirmation modal
            showConfirmationModal();
        }
    });

    // Optional: Add an event listener to remove the red border when the user starts typing
    $('.asterisk input, .asterisk select.form-select, .asterisk textarea').on('input', function () {
        if ($(this).val().trim() !== '') {
            $(this).removeClass('is-invalid');
        }
    });
    
    // Function to show SweetAlert confirmation modal
    function showConfirmationModal() {
        Swal.fire({
            title: "Do you want to save the changes?",
            showDenyButton: true,
            showCancelButton: true,
            confirmButtonText: "Save",
            denyButtonText: `Don't save`
        }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed) {
                // Perform form submission or any other action
                submitForm();
            } else if (result.isDenied) {
                Swal.fire("Changes are not saved", "", "info");
            }
        });
    }

    // Function to handle form submission
    function submitForm() {
        //Retrieve token
        var token = localStorage.getItem('token');
        if (!token) {
        console.error('No token found');
        return;
    }
        //Serialize the form data as JSON
        var formData = {
            title: $('#title').val(),
            projType: $('#projType').val(),
            description: $('#description').val(),
            status: $('#status').val(),
            budget: $('#budget').val(),
            duration: $('#duration').val(),
            started: $('#started').val(),
            source: $('#source').val()
            // ... other fields
        };

        $.ajax({
            url: "https://bitbo-standard-dep-dd2462e5a0a8.herokuapp.com/projects/add",
            type: "POST",
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json',
            },
            data: JSON.stringify(formData),
            dataType: 'json',
            success: function (response) {
                console.log("Project added successfully");
                // Close the second modal after success
                $('#secondmodal').modal('hide');
                Swal.fire("Saved!", "", "success");
            },
            error: function (error) {
                console.error("Error in adding Project:", error.responseText);
            }
        });
    }
});

 //SECURITY--------------
       // Check for the token when the page loads
       document.addEventListener("DOMContentLoaded", function() {
             var token = localStorage.getItem('token');
             if (token) {
                 // Show the services content if the token is present
                 document.getElementById('whole-content').style.display = 'block';
             } else {
                 // Redirect to login if token is not present
                 window.location.href = "/login";  // Adjust the login page URL if necessary
             }
         });

  </script>

   {% endblock %}
   {% endblock %}