<div id="whole-content" style="display: none;">
{% extends 'main/index.html' %}
{% load static %}
{% block content %}
  
  
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="square">
                <div class="container-fluid">
                    <div class="row justify-content-start" >
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header align-items-center d-flex justify-content-between">
                                    <h4 class="mb-sm-0">Personnel Record</h4>
                                </div>
                                <!-- end card header -->
                                <div class="card-body">
                                    <div class="live-preview">
                                        <br>
                                        <div class="row gy-4">
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                    <label for="firstname" class="form-label">First Name <span>*</span></label>
                                                    <input type="form" class="form-control" id="first_name" placeholder="First Name">
                                                </div>
                                            </div>
                                            <!--end col-->
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="optional">
                                                    <label for="labelInput" class="form-label">Middle Name (Optional) </label>
                                                    <input type="text" class="form-control" id="middle_name" placeholder="Middle Name" >
                                                </div>
                                            </div>
                                            <!--end col-->
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk"> 
                                                    <label for="lastname" class="form-label">Last Name <span>*</span></label>
                                                    <input type="form" class="form-control" id="last_name" placeholder="Last Name" >
                                                </div>
                                            </div>
                                            <!--end col-->
                                            <div class="col-xxl-3 col-md-6">
                                               <div class="optional">
                                                        <label for="Suffix" class="form-label">Suffix</label>
                                                        <div class="input-group">
                                                            <select class="form-select" id="suffix" >
                                                                <option value="" disabled selected>Select a suffix</option>
                                                                <option value="Sr.">Sr.</option>
                                                                <option value="Jr.">Jr.</option>
                                                                <option value="I">I</option>
                                                                <option value="II">II</option>
                                                                <option value="III">III</option>
                                                            </select>
                                                        </div>
                                                        </div>
                                                    </div>
                                            
                                            <!--end col-->
                                     
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                    <label for="exampleInputdate" class="form-label">Birthday <span>*</span></label>
                                                    <input type="date" class="form-control" id="birthday" >
                                                </div>
                                            </div>
                                            <!--end col-->
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                    <label for="email" class="form-label">Email <span>*</span></label>
                                                    <div class="form-icon right">
                                                        <input type="email" class="form-control form-control-icon" id="email" placeholder="example@gmail.com" >
                                                        <i class="ri-mail-unread-line"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--end col-->
                            
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                    <label for="phonenum" class="form-label">Contact Number <span>*</span></label>
                                                    <div class="form-icon right">
                                                        <input type="text" class="form-control form-control-icon" id="contact_no" placeholder="09*******" >
                                                        <i class="ri-phone-line"></i>
                                                </div>
                                                </div>
                                            </div>
                                            <!--end col-->
                                      
                                            <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                <label for="Occupation" class="form-label">Position <span>*</span></label>
                                                <select class="form-select" id="position" required onchange="showAdditionalFieldsPosition()">
                                                    <option value="" disabled selected>Select Position</option>
                                                    <option value="Secretary">Secretary</option>
                                                    <option value="Treasurer">Treasurer</option>
                                                    <option value="Health Worker">Health Worker</option>
                                                    <option value="Tanod">Tanod</option>

                                                    
                                                </select>
                                                </div>
                                            </div>
                                              <!-- Insert Photo -->
                                              <div class="col-xxl-3 col-md-6">
                                                <div class="asterisk">
                                                    <label for="formFile" class="form-label">Profile Photo <span>*</span></label>
                                                    <input class="form-control" type="file" id="formFile" name="photo_path">
                                                </div>
                                            </div>
                                       
                                               <!-- start of buttons -->
                                                <div class="card-body">
                                                    <div class="live-preview">
                                                        <div class="button-container">
                                                            <!-- cancel button with modals -->
                                                            <button class="btn btn-primary waves-effect waves-light" data-bs-toggle="modal" data-bs-target=".bs-example-modal-center">Cancel</button>
                                                            <div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog modal-dialog-centered">
                                                                    <div class="modal-content">
                                                                        <div class="modal-body text-center p-5">
                                                                            <div class="mt-4">
                                                                                <h4 class="mb-3">Are you sure you want to cancel?</h4>
                                                                                <div class="hstack gap-2 justify-content-center">
                                                                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">No</button>
                                                                                    <a href="{% url 'personnel' %}" class="btn btn-danger">Yes</a>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div><!-- /.modal-content -->
                                                                </div><!-- /.modal-dialog -->
                                                            </div><!-- /.modal -->
                                                        <div class="save-button">
                                                            <button type="button" class="btn btn-success waves-effect waves-light" id="confirmSubmitBtn">Save</button>                                                      
                                                        </div><!-- end save button -->
                                                                    </div><!-- end button container -->
                                                                </div><!-- end live preview -->
                                                            </div><!-- end card body (Start button) -->
                                                        </div> <!--end col lg emergency info-->
                                                    </div><!--card-body start personal info--> 
                                                </div><!--card personal info--> 
                                             </div><!--col lg personal info-->
                                        </div><!-- row personal info -->
                                    </div><!-- end container fluid -->
                                </div><!--end of square-->   
                                </div><!--div protection-->
                                            

{% block css %}
<link rel="stylesheet" href="{% static 'css/admin_forms.css' %}">
{% endblock %}

{% block js %}
    <script src="{% static 'js/form.js' %}"></script>
    <script src="{%static 'js/occupation' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!--CONNECTION CLIENT TO SERVER-->
    <script>
        $("#confirmSubmitBtn").unbind('click').click(function (event) {
        event.preventDefault();
        var isValid = true;
        $('.asterisk input, .asterisk select, .asterisk textarea').each(function () { // Modified selector to target all input, select, and textarea elements within elements with class .asterisk
            var fieldValue = $(this).val();
            if (!fieldValue || fieldValue.trim() === '') { // Check if no value is entered or if the entered value is empty
                $(this).addClass('is-invalid');
                isValid = false;
                Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Personal information fields are required! ",
                });
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        if (isValid) {
            confirmSave();
        }
    });

    // Optional: Add an event listener to remove the red border when the user starts typing
    $('.asterisk input, .asterisk select, .asterisk textarea').on('input', function () {
        if ($(this).val().trim() !== '') {
            $(this).removeClass('is-invalid');
        }
    });

    
    // Function to handle form submission
    function submitForm() {
        // Create a FormData object
        var formData = new FormData();
    
        // Append form fields to formData
        formData.append('first_name', $('#first_name').val());
        formData.append('middle_name', $('#middle_name').val());
        formData.append('last_name', $('#last_name').val());
        formData.append('suffix', $('#suffix').val());
        formData.append('birthday', $('#birthday').val());
        formData.append('email', $('#email').val());
        formData.append('contact_no', $('#contact_no').val());
        formData.append('position', $('#position').val());
        
    
        var fileInput = $('#formFile')[0];
    
        if (fileInput.files.length > 0) {
            formData.append('photo_path', fileInput.files[0]);
        } else {
            console.error("No file selected");
            return;
        }
    
        $.ajax({
            url: 'https://bitbo-standard-dep-dd2462e5a0a8.herokuapp.com/personnels/add',
            type: 'POST',
            headers: {
                "Authorization": "Bearer " + localStorage.getItem('token')
            },
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                console.log(response);
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
                var responseJSON = xhr.responseJSON;
                if (responseJSON && responseJSON.detail) {
                    console.error("Detailed Error:", responseJSON.detail);
                }
            }
        });
    }

//SAVE MODAL
function confirmSave() {
                Swal.fire({
                    title: "Do you want to save the changes?",
                    showDenyButton: true,
                    showCancelButton: true,
                    confirmButtonText: "Save",
                    denyButtonText: `Don't save`
                }).then((result) => {
                    if (result.isConfirmed) {
                        // SweetAlert confirmation
                        Swal.fire("Saved!", "", "success").then(() => {
                            // Trigger the form submission when "Save" is clicked
                            submitForm();
                        });
                    } else if (result.isDenied) {
                        Swal.fire("Changes are not saved", "", "info");
                        // Handle any additional actions or don't open the first modal
                    }
                });
            }

    
     //SECURITY
         // Check for the token when the page loads
         document.addEventListener("DOMContentLoaded", function() {
             var token = localStorage.getItem('token');
             if (token) {
                 // Show the services content if the token is present
                 document.getElementById('whole-content').style.display = 'block';
             } else {
                 // Redirect to login if token is not present
                 window.location.href = "/login";  // Adjust the login page URL if necessary
             }
         });
    </script>
    {% endblock %}

{% endblock %}

